<!DOCTYPE html> 
<html xmlns:fb="https://www.facebook.com/2008/fbml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <title>Works? Photo Aggregator. Browsing photos made easy. </title>
        <script type="text/javascript">
            var button;
            var userInfo;
            
            window.fbAsyncInit = function() {
                FB.init({ appId: '166096070190835', 
                    status: true, 
                    cookie: true,
                    xfbml: true,
                    oauth: true});

               showLoader(true);
               
               function updateButton(response) {
                    button       =   document.getElementById('fb-auth');
                    userInfo     =   document.getElementById('user-info');
                    
                    if (response.authResponse) {
                        //user is already logged in and connected
                        FB.api('/me', function(info) {
                            login(response, info);
                        });
                        
                        button.onclick = function() {
                            FB.logout(function(response) {
                                logout(response);
                            });
                        };
                    } else {
                        //user is not connected to your app or logged out
                        button.innerHTML = 'Login';
                        button.onclick = function() {
                            showLoader(true);
                            FB.login(function(response) {
                                if (response.authResponse) {
                                    FB.api('/me', function(info) {
                                        login(response, info);
                                    });    
                                } else {
                                    //user cancelled login or did not grant authorization
                                    showLoader(false);
                                }
                            }, {scope:'email,user_photos, friends_photos'});    
                        }
                    }
                }
                
                // run once with current status and whenever the status changes
                FB.getLoginStatus(updateButton);
                FB.Event.subscribe('auth.statusChange', updateButton);  
            };
            (function() {
                var e = document.createElement('script'); e.async = true;
                e.src = document.location.protocol 
                    + '//connect.facebook.net/en_US/all.js';
                document.getElementById('fb-root').appendChild(e);
            }());
            
            function login(response, info){
                if (response.authResponse) {
                    var accessToken                                 =   response.authResponse.accessToken;
                    
                    userInfo.innerHTML                             = '<img src="https://graph.facebook.com/' + info.id + '/picture">' + info.name
                                                                     + "<br /> Your Access Token: " + accessToken
                                                                     + "id = " + info.id + "<br/>"
                    button.innerHTML                               = 'Logout';
                    showLoader(false);
                    document.getElementById('other').style.display = "block";
                }
            }
        
            function logout(response){
                userInfo.innerHTML                             =   "";
                document.getElementById('debug').innerHTML     =   "";
                document.getElementById('other').style.display =   "none";
                showLoader(false);
            }

            

            function albumQuery(){
                showLoader(true);
                FB.api('/me/albums', function(resp) {
                    showLoader(false);
                    var all_names = "";
                    alert(resp.data.length); 
                    for (var i=0, l=resp.data.length; i<l; i++){
                        all_names = all_names + "<br/>" + resp.data[i].name;
                    }
                    alert(all_names); 
                    document.getElementById('debug').innerHTML =  all_names;
                });
            }

            function friendsAlbums(){
                showLoader(true);
                FB.api('/vipartha/albums', function(resp) {
                    showLoader(false);
                    var all_names = "";
                    alert(resp.data.length); 
                    var total_photos = 0 ; 
                    for (var i=0, l=resp.data.length; i<l; i++){
                        all_names = all_names + "<br/>" + resp.data[i].name +
                        "(" + resp.data[i].count + ")";
                        total_photos = total_photos + resp.data[i].count ; 
                    }
                    document.getElementById('debug').innerHTML =  "Analyzing " +
                    total_photos + " photos...<br/>" + all_names; 
                });
            }

            function friendsQuery(){
                showLoader(true);
                FB.api('/me/mutualfriends/560059253', function(resp) {
                    showLoader(false);
                    var all_names = "";
                    alert(resp.data.length); 
                    for (var i=0, l=resp.data.length; i<l; i++){
                        all_names = all_names + "<br/>" + resp.data[i].name +
                        '(' + resp.data[i].id + ')'; 
                    }
                    alert(all_names); 
                    document.getElementById('debug').innerHTML =  all_names;
                });
            }
            
            
        </script>
    </head>
    <body>
        <div id="fb-root"></div>
        <h3>Photo Aggregator. Browsing photos made easy. </h3>
        <button id="fb-auth">Login</button>
        <div id="loader" style="display:none">
            <img src="ajax-loader.gif" alt="loading" />
        </div>
        <br />
        <div id="user-info"></div>
        <br />
        <div id="debug"></div>
        <div id="albums"></div>
        
        <div id="other" style="display:none">
            <a href="#" onclick="albumQuery(); return false;">All your albums</a>
            <a href="#" onclick="friendsQuery(); return false;"> Your friends</a>
            <a href="#" onclick="friendsAlbums(); return false;">Your friends' album</a>
        </div>
    </body>
</html>
